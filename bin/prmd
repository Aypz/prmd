#!/usr/bin/env ruby

require 'prmd'

command = ARGV[0]

def directory
  if File.directory?(ARGV[1])
    ARGV[1]
  end
end

def schema
  if File.exists?(ARGV[1])
    JSON.parse(File.read(ARGV[1]))
  else
    {}
  end
end

command = ARGV[0]

case command
when 'combine'
  Prmd.combine(directory)
when 'doc'
  Prmd.doc(directory)
when 'init'
  Prmd.init(ARGV[1], ARGV[2])
when 'verify'
  if directory
    Dir.glob(File.join(directory, '**/*.json')).each do |path|
      puts(path)
      Prmd.verify(JSON.parse(File.read(path)))
      puts
    end
  else
    Prmd.verify(schema)
  end
end
